# User Service (FullstackNode)

?????? ?????????? ?????????????? ?? ??: ???????????, ???????????, ????, ??????, ?????????? ???????? ? ?????-??????. ?????? ???????? backend ?? Express + MongoDB ? ??????? frontend ?? Vite.

## ??? ??????????? ?? ??
- ?????? ????????????: **???**, **???? ????????**, **email (??????????)**, **??????**, **???? (admin/user)**, **?????? (active)**.
- Endpoint-?:
  - `POST /api/auth/register` — ???????????
  - `POST /api/auth/login` — ???????????
  - `GET /api/users/:id` — ???????? ???????????? (admin ??? ???)
  - `GET /api/users` — ?????? ????????????? (?????? admin)
  - `PATCH /api/users/:id/block` — ?????????? (admin ??? ???)
- ?????????????:
  - `GET /api/auth/profile` — ??????? ???????? ????????????
  - `PUT /api/auth/update-profile` — ?????????? ???????
  - `POST /api/auth/logout` — ?????
  - `GET /api/dashboard` — ?????????? ???????

## ??????????
- **Backend:** Node.js, Express, Mongoose, JWT (httpOnly cookies), CORS, Helmet, Rate Limiting, TypeScript
- **Frontend:** Vite, TypeScript, ?????? HTML/CSS/JS
- **????:** MongoDB
- **Docker:** docker-compose (node:20 ??? frontend ? backend)

## ????????? ???????
- `backend/` — API, ??????, middleware, ????????
- `frontend/` — ??????????? ???????? + JS
- `docker-compose.yml` — ?????? ??????????????

## ?????? ????????????
```json
{
  "fullName": "?????? ???? ????????",
  "birthDate": "1995-04-12",
  "email": "user@example.com",
  "username": "ivan95",
  "password": "hashed",
  "role": "user | admin",
  "isActive": true
}
```

## ??????????? (?????)
- JWT ???????? ? **httpOnly cookie** (??? localStorage).
- ??? ?????????? ??????? ???? ? `credentials: "include"`.
- ??????????????? ???????????? ?? ????? ??????? ? ???????? ??????.

## ?????????? ?????????
????: `backend/.env`
```
JWT_SECRET=super_long_random_value
MONGO_URI=mongodb://root:password@mongo:27017/auth-demo?authSource=admin
```

## ??????? ????? (Docker)
```bash
docker compose up --build
```

Frontend: `http://localhost:5173`  
Backend: `http://localhost:3000`

### ???????? ???????????? ?????????????
```bash
docker compose exec web npm run migrate:users
```

## ?????? ??? Docker
```bash
cd backend
npm install
npm start
```
```bash
cd frontend
npm install
npm run dev
```

## ??????? ????????
### ???????????
`POST /api/auth/register`
```json
{
  "fullName": "?????? ???? ????????",
  "birthDate": "1995-04-12",
  "email": "user@example.com",
  "username": "ivan95",
  "password": "secret123"
}
```

### ?????
`POST /api/auth/login`
```json
{
  "email": "user@example.com",
  "password": "secret123"
}
```

### ???????? ???????????? ?? ID (admin ??? ???)
`GET /api/users/:id`

### ?????? ????????????? (admin)
`GET /api/users`

### ?????????? ???????????? (admin ??? ???)
`PATCH /api/users/:id/block`

## ????????????
- `helmet()` ??? ??????? ??????????
- `express-rate-limit` (200 ???????? / 15 ???)
- `httpOnly` cookie ??? JWT

## Docker image (???????????)
Dockerfile ??? backend ? frontend:
- `backend/Dockerfile`
- `frontend/Dockerfile`

?????? ???????:
```bash
docker build -t user-service-backend ./backend
docker build -t user-service-frontend ./frontend
```

?????? ??????? (??? compose):
```bash
docker run -p 3000:3000 --env-file ./backend/.env user-service-backend
docker run -p 5173:5173 user-service-frontend
```

## ?????? (??????)
**??????? 1: Docker Compose**
```bash
docker compose up -d --build
```

**??????? 2: Docker images**
1. ??????? ?????? ??? ????
2. ?????? ?????????? ????????? (`JWT_SECRET`, `MONGO_URI`)
3. ????????? ??????????

? ????? ?????????????:
- HTTPS
- `sameSite: "none"` ? `secure: true` ??? cookie
- ????????? MongoDB (managed ??? self-hosted)
